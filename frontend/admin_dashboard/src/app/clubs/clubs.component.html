<div class="mt-10 py-6 mx-10">
    <h1 class="text-2xl font-semibold text-center mb-4">Verenigingen</h1>
    <form (submit)="addClub()" class="text-left">

        <!-- Club Field -->
        <div class="mb-2 max-w-md mx-auto">
            <label for="club" class="block text-sm font-medium text-gray-700">Vereniging</label>
            <select
                id="club"
                name="club"
                [(ngModel)]="selectedClubId"
                (change)="onModelChange()"
                class="w-full mt-2 px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
            >
                <option [value]="0">Nieuwe Vereniging</option>
                <option *ngFor="let club of allClubs" [value]="club.id">{{ club.name }}</option>
            </select>
        </div>

        <!-- Fields to Create a new Club -->
        <div *ngIf="selectedClubId == 0" class="mb-8 grid grid-cols-1 md:grid-cols-3 gap-4 col-span-2">
            <!-- Name Field -->
            <div class="">
                <label for="name" class="block text-sm font-medium text-gray-700">Naam Vereniging</label>
                <input
                    required
                    type="text"
                    id="name"
                    name="name"
                    [(ngModel)]="newClub.name"
                    #name="ngModel"
                    class="w-full mt-2 px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                />
            </div>

            <!-- Email Field -->
            <div class="">
                <label for="email" class="block text-sm font-medium text-gray-700">E-mail</label>
                <input
                    required
                    type="text"
                    id="email"
                    name="email"
                    [(ngModel)]="newClub.email"
                    #email="ngModel"
                    class="w-full mt-2 px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                />
            </div>

            <!-- Contact Field -->
            <div class="">
                <label for="contact" class="block text-sm font-medium text-gray-700">Contact</label>
                <input
                    required
                    type="text"
                    id="contact"
                    name="contact"
                    [(ngModel)]="newClub.contact"
                    #contact="ngModel"
                    class="w-full mt-2 px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                />
            </div>

            <!-- Phone Field -->
            <div class="">
                <label for="phonenumber" class="block text-sm font-medium text-gray-700">Telefoon</label>
                <input
                    required
                    type="text"
                    id="phonenumber"
                    name="phonenumber"
                    [(ngModel)]="newClub.phone"
                    #phonenumber="ngModel"
                    class="w-full mt-2 px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                />
            </div>

            <!-- Bank Account Field -->
            <div class="">
                <label for="bankaccount" class="block text-sm font-medium text-gray-700">Banknummer</label>
                <input
                    required
                    type="text"
                    id="bankaccount"
                    name="bankaccount"
                    [(ngModel)]="newClub.bank_account"
                    #bankaccount="ngModel"
                    class="w-full mt-2 px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                />
            </div>

            <!-- BTW Number Field -->
            <div class="">
                <label for="btwnumber" class="block text-sm font-medium text-gray-700">BTW-nummer</label>
                <input
                    required
                    type="text"
                    id="btwnumber"
                    name="btwnumber"
                    [(ngModel)]="newClub.btw_number"
                    #btwnumber="ngModel"
                    class="w-full mt-2 px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                />
            </div>

            <!-- Address Field -->
            <div class="">
                <label for="address" class="block text-sm font-medium text-gray-700">Adres</label>
                <input
                    required
                    type="text"
                    id="address"
                    name="address"
                    [(ngModel)]="newClub.address"
                    #address="ngModel"
                    class="w-full mt-2 px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                />
            </div>

            <!-- Postal Code Field -->
            <div class="">
                <label for="postalcode" class="block text-sm font-medium text-gray-700">Postcode</label>
                <input
                    required
                    type="text"
                    id="postalcode"
                    name="postalcode"
                    [(ngModel)]="newClub.postal_code"
                    #postalcode="ngModel"
                    class="w-full mt-2 px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                />
            </div>

            <!-- City Field -->
            <div class="">
                <label for="city" class="block text-sm font-medium text-gray-700">Gemeente</label>
                <input
                    required
                    type="text"
                    id="city"
                    name="city"
                    [(ngModel)]="newClub.city"
                    #city="ngModel"
                    class="w-full mt-2 px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                />
            </div>
        </div>

        <!-- Volunteers -->
        <div *ngIf="selectedClubId != 0" class="mt-2 max-w-md mx-auto">
            <button type="button" class="w-full mt-2 py-2 px-4 bg-purple-400 text-gray-900 rounded-md hover:bg-purple-500 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            Beheer Vrijwilligers
            </button>
        </div>

        <div *ngIf="selectedClubId != 0" class="mt-2 max-w-md mx-auto">
            <button (click)="openDeleteModal(selectedClub)" type="button" class="w-full mt-2 py-2 px-4 bg-purple-400 text-gray-900 rounded-md hover:bg-purple-500 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            Verwijder Vereniging
            </button>
        </div>

        <div *ngIf="!isClubParticipating()" class="mt-2 max-w-md mx-auto">
            <button type="submit" class="w-full mt-2 py-2 px-4 bg-purple-400 text-gray-900 rounded-md hover:bg-purple-500 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            Voeg Vereniging Toe
            </button>
        </div>
    </form>
</div>

<!-- Participating Club Table -->
<div class="mt-8 mx-10">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-semibold text-gray-700">
            Verenigingen {{editionYear}}
        </h2>
    </div>
    <div class="overflow-x-auto rounded-md shadow overflow-y-auto" *ngIf="!loadingClubs && !loadingParticipatingClubs">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg shadow-md">
        <thead>
            <tr class="bg-gray-50">
            <th class="py-3 px-4 border-b text-start">Vereniging</th>
            <th class="py-3 px-4 border-b text-start">E-mail</th>
            <th class="py-3 px-4 border-b text-start">Contact</th>
            <th class="py-3 px-4 border-b text-start">Telefoon</th>
            <th class="py-3 px-4 border-b text-start">Link</th>
            <th class="py-3 px-4 border-b text-start">Banknummer</th>
            <th class="py-3 px-4 border-b text-start">BTW-nummer</th>
            <th class="py-3 px-4 border-b text-start">Adres</th>
            <th class="py-3 px-4 border-b text-start">Postcode</th>
            <th class="py-3 px-4 border-b text-start">Gemeente</th>
            <th class="py-3 px-4 border-b text-start">Supervisors Dag 1</th>
            <th class="py-3 px-4 border-b text-start">Supervisors Dag 2</th>
            <th class="py-3 px-4 border-b text-center">Acties</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let club of participatingClubs" class="hover:bg-gray-100">
            <td class="py-2 px-4 border-b text-start">{{ clubDictionary[club.club_id].name }}</td>
            <td class="py-2 px-4 border-b text-start">{{ clubDictionary[club.club_id].email }}</td>
            <td class="py-2 px-4 border-b text-start">{{ clubDictionary[club.club_id].contact }}</td>
            <td class="py-2 px-4 border-b text-start">{{ clubDictionary[club.club_id].phone }}</td>
            <td class="py-2 px-4 border-b text-start">
                <app-icon-button (click)="openLinkModal(clubDictionary[club.club_id])" icon="external-link"></app-icon-button>
            </td>
            <td class="py-2 px-4 border-b text-start">{{ clubDictionary[club.club_id].bank_account }}</td>
            <td class="py-2 px-4 border-b text-start">{{ clubDictionary[club.club_id].btw_number }}</td>
            <td class="py-2 px-4 border-b text-start">{{ clubDictionary[club.club_id].address }}</td>
            <td class="py-2 px-4 border-b text-start">{{ clubDictionary[club.club_id].postal_code }}</td>
            <td class="py-2 px-4 border-b text-start">{{ clubDictionary[club.club_id].city }}</td>
            <td class="py-2 px-4 border-b text-start">
                {{ club.person_in_charge_day1 }}
                <ng-container *ngIf="club.person_in_charge_day1 !== null && club.person1_in_charge_day1">, </ng-container>
                {{ club.person1_in_charge_day1 }}
            </td>
            <td class="py-2 px-4 border-b text-start">
                {{ club.person_in_charge_day2 }}
                <ng-container *ngIf="club.person_in_charge_day2 !== null && club.person1_in_charge_day2">, </ng-container>
                {{ club.person1_in_charge_day2 }}
            </td>
            <td class="py-2 px-4 border-b text-center">
                <div class="flex justify-center gap-4">
                    <app-icon-button (click)="openEditModal(club)" icon="edit"></app-icon-button>
                    <app-icon-button (click)="openDeleteParticipatingModal(club)" icon="trash-2"></app-icon-button>
                </div>
            </td>
            </tr>
        </tbody>
        </table>
    </div>

    <app-loading *ngIf="loadingClubs || loadingParticipatingClubs" class="mt-10"></app-loading>
</div>

<!-- Unique Link Window -->
<app-modal
    *ngIf="clubToManageLinkFor !== undefined && clubToManageLinkFor !== null"
    #linkModal
    [header]="clubToManageLinkFor.name + ': Link Dataverzameling'"
    [maxWidth]="900"
    [minHeight]="150"
>
    <!-- Unique Link -->
    <p class="text--600" *ngIf="link !==''">
        <!-- Link is opened in a new browser tab -->   
        <strong>link: </strong><a [href]="link" target="_blank" class="text-blue-500 underline hover:text-blue-700">{{ link }}</a>
    </p>

    <p class="text--600" *ngIf="link ===''">    
        <strong>link: </strong>Er werd nog geen link voor deze club gegenereerd.
    </p>

    <!-- Messages -->
    <div class="mb-4">
        <p *ngIf="linkSent !==''" class="text-green-600 font-semibold mt-3">{{ linkSent }}</p>
        <p *ngIf="errorLinkSending !==''" class="text-red-600 font-semibold mt-3">{{ errorLinkSending }}</p>
    </div>

    <div class="mb-4">
        <p *ngIf="linkGenerated !==''" class="text-green-600 font-semibold mt-3">{{ linkGenerated }}</p>
        <p *ngIf="errorLinkGeneration !==''" class="text-red-600 font-semibold mt-3">{{ errorLinkGeneration }}</p>
    </div>

    <!-- Buttons -->
    <div class="flex space-x-2">
        <button
            (click)="generateLink()"
            type="button"
            class="flex-1 py-2 px-4 bg-purple-400 text-gray-900 rounded-md hover:bg-purple-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
        >
            Nieuwe Link Genereren
        </button>

        <button
            (click)="sendLink()"
            [disabled]="link ===''"
            type="button"
            class="flex-1 py-2 px-4 bg-purple-400 text-gray-900 rounded-md hover:bg-purple-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
        >
            Verstuur Link naar Club
        </button>
    </div>
</app-modal>

<!-- Delete Window -->
<app-modal
    *ngIf="clubToDelete !== null"
    #deleteModal
    [header]="'Verwijder ' + clubDictionary[clubToDelete.id].name"
    [maxWidth]="500"
    [minHeight]="150"
>
    <p class="mb-4">Bent u zeker dat u deze vereniging wil verwijderen?</p>

    <div class="mb-4">
        <p *ngIf="clubDeleted !==''" class="text-green-600 font-semibold mt-3">{{ clubDeleted }}</p>
        <p *ngIf="errorClubDeletion !==''" class="text-red-600 font-semibold mt-3">{{ errorClubDeletion }}</p>
    </div>

    <button
        *ngIf = "clubDeleted === ''"
        (click)="deleteClub()"
        type="submit"
        class="w-full py-2 px-4 bg-purple-400 text-gray-900 rounded-md hover:bg-purple-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
    >
        Bevestigen
    </button>
</app-modal>
  
<!-- Delete Participating Window -->
<app-modal
    *ngIf="participatingClubToDelete !== null"
    #deleteParticipatingModal
    [header]="'Verwijder ' + clubDictionary[participatingClubToDelete.club_id].name + ' uit ' + editionYear"
    [maxWidth]="500"
    [minHeight]="150"
>
    <p class="mb-4">Bent u zeker dat u deze vereniging wil verwijderen uit editie {{ editionYear }}?</p>

    <div class="mb-4">
        <p *ngIf="participatingClubDeleted !==''" class="text-green-600 font-semibold mt-3">{{ participatingClubDeleted }}</p>
        <p *ngIf="errorParticipatingClubDeletion !==''" class="text-red-600 font-semibold mt-3">{{ errorParticipatingClubDeletion }}</p>
    </div>

    <button
        *ngIf = "participatingClubDeleted === ''"
        (click)="deleteParticipatingClub()"
        type="submit"
        class="w-full py-2 px-4 bg-purple-400 text-gray-900 rounded-md hover:bg-purple-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
    >
        Bevestigen
    </button>
</app-modal>
  
<!-- Edit Window -->
<app-modal
    *ngIf="tshirtToEdit !== null"
    #editModal
    [header]="'T-shirt ' + tshirtToEdit.model + ' Aanpassen'"
    [maxWidth]="500"
>
<form (submit)="updateTshirt(tshirtToEdit)" class="text-left">
    <!-- Model Field -->
    <div class="mb-4">
    <label for="editModel" class="block text-sm font-medium text-gray-700">Model</label>
    <input
        type="text"
        id="editModel"
        name="editModel"
        [(ngModel)]="tshirtToEdit.model"
        #editModel="ngModel"
        class="w-full mt-2 px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
    />
    </div>

    <!-- Sizes Field -->
    <div class="mb-4">
    <label for="sizes" class="block text-sm font-medium text-gray-700">Maten</label>
    <div class="relative" *ngIf="!loadingVolunteers">
        <app-custom-dropdown>
        <!-- Dropdown Header -->
        <ng-container header>
            <ng-container *ngFor="let size of tshirtToEdit.sizes">
            {{ size.size }}<ng-container *ngIf="size !== tshirtToEdit.sizes[tshirtToEdit.sizes.length - 1]">, </ng-container>
            </ng-container>
            <ng-container *ngIf="!tshirtToEdit.sizes.length">Kies Maten</ng-container>
        </ng-container>

        <!-- Dropdown Body -->
        <ng-container body>
            <div *ngFor="let volunteer of volunteers" class="flex items-center justify-between px-4 py-2">
            <!-- <label class="inline-flex items-center">
                <input
                type="checkbox"
                [value]="size.size"
                (change)="toggleEditSize(size)"
                [checked]="tshirtToEditSizes.includes(size.id)"
                class="form-checkbox"
                />
                <span class="ml-2">{{ size.size }}</span>
            </label> -->
            </div>
        </ng-container>
        </app-custom-dropdown>
    </div>
    </div>

    <!-- Price Field -->
    <div class="mb-4">
    <label for="editPrice" class="block text-sm font-medium text-gray-700">Prijs</label>
    <input
        type="text"
        id="editPrice"
        name="editPrice"
        [(ngModel)]="tshirtToEdit.price"
        #editPrice="ngModel"
        class="w-full mt-2 px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
    />
    </div>

    <div class="mb-4">
    <p *ngIf="tshirtEdited !==''" class="text-green-600 font-semibold mt-3">{{ tshirtEdited }}</p>
    <p *ngIf="errorTshirtEdit !==''" class="text-red-600 font-semibold mt-3">{{ errorTshirtEdit }}</p>
    </div>
    <button type="submit" class="w-full py-2 px-4 bg-purple-400 text-gray-900 rounded-md hover:bg-purple-500 focus:outline-none focus:ring-2 focus:ring-indigo-500">
    T-shirt Aanpassen
    </button>
</form>
</app-modal>